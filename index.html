<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Conteúdo para Psicólogos</title>
    <!-- Importa o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Importa o Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <!-- Importa o Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" xintegrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Estilo para um scroll suave */
        html {
            scroll-behavior: smooth;
        }
        /* Paleta Catppuccin Latte (Tema Claro) */
        :root {
            --rosewater: #dc8a78;
            --flamingo: #dd7878;
            --pink: #ea76cb;
            --mauve: #8839ef; /* Roxo */
            --red: #d20f39;
            --maroon: #e64553;
            --peach: #fe640b;
            --yellow: #df8e1d;
            --green: #40a02b;
            --teal: #179299;
            --sky: #04a5e5;
            --sapphire: #209fb5;
            --blue: #1e66f5;
            --lavender: #7287fd;
            --text: #4c4f69; /* Texto escuro */
            --subtext1: #5c5f77;
            --subtext0: #6c6f85;
            --overlay2: #7c7f93;
            --overlay1: #8c8fa1;
            --overlay0: #9ca0b0;
            --surface2: #acb0be;
            --surface1: #bcc0cc;
            --surface0: #ccd0da;
            --base: #eff1f5;   /* Fundo dos cards e campos */
            --mantle: #e6e9ef; /* Fundo principal */
            --crust: #dce0e8;  
        }
        /* Estilos para a aparência do app */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--mantle);
            color: var(--text);
        }
        .gradient-text {
            background: -webkit-linear-gradient(45deg, var(--mauve), var(--pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Estilo para a área de conteúdo gerado (prose) */
        .prose h3 {
            color: var(--mauve);
        }
        .prose h4 {
             color: var(--pink);
        }
        .prose p, .prose li {
            color: var(--subtext1);
        }
        .prose strong {
            color: var(--text);
        }
        .prose .hashtags {
            color: var(--sky);
            font-style: italic;
        }
        .suggestion-text {
            color: var(--blue);
            font-style: italic;
            font-size: 0.9rem;
        }
    </style>
     <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="antialiased">

    <div id="app" class="min-h-screen p-4 sm:p-6 lg:p-8">
        <div class="max-w-7xl mx-auto">
            
            <!-- Cabeçalho -->
            <header class="text-center mb-10">
                <h1 class="text-4xl sm:text-5xl font-bold gradient-text">Gerador de Conteúdo IA</h1>
                <p class="mt-2 text-lg" style="color: var(--subtext0);">Para profissionais de Psicologia</p>
            </header>

            <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Coluna da Esquerda: Planejamento Estratégico -->
                <div id="planning-module" class="lg:col-span-1 p-6 rounded-2xl shadow-lg" style="background-color: var(--base);">
                    <h2 class="text-2xl font-semibold mb-2" style="color: var(--text);">Planejamento Estratégico</h2>
                    <p class="mb-6" style="color: var(--subtext0);">Defina a base para a IA criar conteúdos alinhados.</p>

                    <!-- Campo para a Chave da API (Condicional) -->
                    <div class="mb-6">
                        <div v-if="!isApiKeyInjected">
                             <label for="apiKey" class="block text-sm font-medium mb-1"><i class="fas fa-key mr-2" style="color: var(--yellow);"></i>Sua Chave da API do Google AI</label>
                             <input type="password" v-model="apiKey" id="apiKey" class="w-full px-3 py-2 border rounded-md shadow-sm focus:ring-2 focus:border-transparent" style="background-color: var(--base); border-color: var(--pink); color: var(--text); --tw-ring-color: var(--pink);" placeholder="Cole sua chave da API aqui">
                        </div>
                        <div v-else>
                            <p class="text-sm p-2 rounded-md" style="background-color: var(--mantle); color: var(--green);"><i class="fas fa-check-circle mr-2"></i>Chave da API carregada com segurança.</p>
                        </div>
                    </div>
                        <div id="apiKeyDebugDisplay" style="margin-top: 10px; padding: 10px; border: 1px solid red; background-color: #fdd;">API Key for Debug: <span id="apiKeyDebugValue">{{ apiKey }}</span></div>

                    <!-- Definição da Persona -->
                    <div class="mb-6">
                        <label for="persona" class="block text-sm font-medium mb-1"><i class="fas fa-user-circle mr-2" style="color: var(--green);"></i>Defina sua Persona</label>
                        <textarea v-model="persona" id="persona" rows="4" class="w-full px-3 py-2 border rounded-md shadow-sm focus:ring-2 focus:border-transparent" style="background-color: var(--base); border-color: var(--pink); color: var(--text); --tw-ring-color: var(--pink);" :placeholder="personaPlaceholderText"></textarea>
                    </div>

                    <!-- Botão Gerar Pilares -->
                    <div class="mb-6">
                         <button @click="generatePillars" :disabled="isGeneratingPillars || !apiKey || !persona" class="w-full flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm transition-all duration-300 disabled:opacity-50" style="background: linear-gradient(to right, var(--mauve), var(--pink)); color: #fff;" :style="!isGeneratingPillars && apiKey && persona ? {':hover': { 'box-shadow': '0 0 15px ' + 'var(--mauve)' } } : {}">
                            <i v-if="isGeneratingPillars" class="fas fa-spinner fa-spin mr-2"></i>
                            <i v-else class="fas fa-cogs mr-2"></i>
                            <span v-if="isGeneratingPillars">Sugerindo Pilares...</span>
                            <span v-else>Gerar Sugestões de Pilares</span>
                        </button>
                    </div>

                    <!-- Pilares de Conteúdo -->
                    <div class="mb-6">
                        <label for="pilares" class="block text-sm font-medium mb-1"><i class="fas fa-stream mr-2" style="color: var(--sapphire);"></i>Seus Pilares de Conteúdo</label>
                        <textarea v-model="pilares" id="pilares" rows="4" class="w-full px-3 py-2 border rounded-md shadow-sm focus:ring-2 focus:border-transparent" style="background-color: var(--base); border-color: var(--pink); color: var(--text); --tw-ring-color: var(--pink);" :placeholder="pilaresPlaceholderText"></textarea>
                    </div>
                    
                    <!-- Projeção Semanal -->
                    <div>
                        <h3 class="text-lg font-semibold mb-3">Projeção Semanal de Conteúdo</h3>
                        <button @click="generateWeeklySuggestions" :disabled="isGeneratingSuggestions || !apiKey" class="w-full flex justify-center items-center px-4 py-2 mb-4 border border-transparent text-sm font-medium rounded-md shadow-sm text-white transition-all duration-300 disabled:opacity-50" style="background: linear-gradient(to right, var(--mauve), var(--pink)); color: #fff;" :style="isGeneratingSuggestions ? {} : {':hover': { 'box-shadow': '0 0 15px ' + 'var(--mauve)' } }">
                            <i v-if="isGeneratingSuggestions" class="fas fa-spinner fa-spin mr-2"></i>
                             <i v-else class="fas fa-calendar-alt mr-2"></i>
                            <span v-if="isGeneratingSuggestions">Gerando Ideias...</span>
                            <span v-else>Gerar Ideias para a Semana</span>
                        </button>
                        <div class="space-y-3">
                            <div v-for="(day, index) in weeklySchedule" :key="index" class="p-3 rounded-lg border" style="background-color: var(--mantle); border-color: var(--surface0);">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-semibold">{{ day.dayName }} <span class="font-normal" style="color: var(--subtext0);">- {{ day.date }}</span></p>
                                        <p class="text-sm" style="color: var(--mauve);">{{ day.format }}</p>
                                    </div>
                                    <div class="flex items-center">
                                        <button @click="regenerateSuggestion(day, index)" :disabled="day.isRegenerating || !apiKey" class="p-1.5 rounded-full hover:bg-opacity-20 disabled:opacity-50 disabled:cursor-not-allowed" style="background-color: transparent; color: var(--mauve);">
                                            <i v-if="day.isRegenerating" class="fas fa-spinner fa-spin h-4 w-4"></i>
                                            <i v-else class="fas fa-sync-alt h-4 w-4"></i>
                                        </button>
                                        <button @click="selectDay(day)" class="ml-2 px-3 py-1 text-xs font-medium rounded-full" style="color: #fff; background-color: var(--pink);">Selecionar</button>
                                    </div>
                                </div>
                                <p v-if="day.suggestion" class="suggestion-text mt-2">{{ day.suggestion }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Coluna Central e Direita: Geração de Conteúdo -->
                <div id="generation-module" class="lg:col-span-2 p-6 rounded-2xl shadow-lg" style="background-color: var(--base);">
                    <h2 class="text-2xl font-semibold mb-2">Geração de Conteúdo</h2>
                    <p class="mb-6" style="color: var(--subtext0);">Escolha o formato e gere um post pronto para usar.</p>

                    <!-- Linha de Geração -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label for="tipoConteudo" class="block text-sm font-medium mb-1"><i class="fas fa-shapes mr-2" style="color: var(--peach);"></i>Tipo de Conteúdo</label>
                            <select v-model="tipoConteudo" id="tipoConteudo" class="w-full px-3 py-2 border rounded-md shadow-sm focus:ring-2 focus:border-transparent" style="background-color: var(--base); border-color: var(--pink); color: var(--text); --tw-ring-color: var(--pink);">
                                <option value="Reel">Reel (Roteiro curto)</option>
                                <option value="Carrossel">Carrossel (Estrutura com 5 slides)</option>
                                <option value="Legenda Longa">Post com Legenda Longa</option>
                                <option value="Story Interativo">Story Interativo</option>
                                <option value="Live">Live (Ideia e Roteiro)</option>
                            </select>
                        </div>

                        <div class="md:col-span-2">
                            <label for="topico" class="block text-sm font-medium mb-1"><i class="fas fa-bullseye mr-2" style="color: var(--red);"></i>Tópico Específico (Opcional)</label>
                            <input type="text" v-model="topico" id="topico" class="w-full px-3 py-2 border rounded-md shadow-sm focus:ring-2 focus:border-transparent" style="background-color: var(--base); border-color: var(--pink); color: var(--text); --tw-ring-color: var(--pink);" placeholder="Ex: Como lidar com a culpa materna.">
                        </div>
                    </div>
                    
                    <!-- Botão de Gerar -->
                    <button @click="generateContent" :disabled="isLoading || !apiKey" class="w-full flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-lg text-white transition-all duration-300 disabled:opacity-50" style="background: linear-gradient(to right, var(--mauve), var(--pink)); color: #fff;" :style="isLoading ? {} : {':hover': { 'box-shadow': '0 0 20px ' + 'var(--mauve)' } }">
                        <i v-if="isLoading" class="fas fa-spinner fa-spin mr-3"></i>
                         <i v-else class="fas fa-magic mr-2"></i>
                        <span v-if="isLoading">Gerando...</span>
                        <span v-else>Gerar Conteúdo</span>
                    </button>
                    
                     <!-- Mensagem de erro -->
                    <div v-if="errorMessage" class="mt-4 p-4 rounded-md flex items-center" style="background-color: var(--red); color: var(--base);">
                        <i class="fas fa-exclamation-triangle mr-3"></i>
                        <p><strong>Erro:</strong> {{ errorMessage }}</p>
                    </div>

                    <!-- Área de Resultado -->
                    <div v-if="generatedContent || isLoading" class="mt-8">
                        <div class="flex justify-between items-center mb-4">
                             <h3 class="text-xl font-semibold"><i class="fas fa-magic mr-2" style="color: var(--lavender);"></i>Conteúdo Gerado:</h3>
                             <button v-if="generatedContent" @click="copyToClipboard" class="px-4 py-2 text-sm font-medium rounded-md" style="color: #fff; background-color: var(--lavender);">
                                <i class="fas fa-clipboard mr-2"></i>
                                {{ copyButtonText }}
                            </button>
                        </div>
                        <div class="p-4 rounded-lg prose max-w-none min-h-[200px]" style="background-color: var(--mantle); border: 1px dashed var(--pink);" v-html="renderedHtml">
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 
        INSTRUÇÕES PARA DEPLOY NO GITHUB PAGES COM CHAVE DE API SECRETA:
        
        1. Crie um "secret" no seu repositório do GitHub:
           - Vá em "Settings" > "Secrets and variables" > "Actions".
           - Clique em "New repository secret".
           - Dê o nome de `VUE_APP_GEMINI_API_KEY` e cole sua chave da API do Google AI.

        2. Crie um arquivo de workflow para o GitHub Actions:
           - No seu repositório, crie a pasta `.github/workflows`.
           - Dentro dela, crie um arquivo chamado `deploy.yml` com o seguinte conteúdo:

        name: Build and Deploy to GitHub Pages

        on:
          push:
            branches:
              - main # ou a branch que você usa

        jobs:
          build-and-deploy:
            runs-on: ubuntu-latest
            steps:
              - name: Checkout 🛎️
                uses: actions/checkout@v3

              - name: Replace API Key Placeholder 🗝️
                run: |
                  sed -i "s|{{VUE_APP_GEMINI_API_KEY}}|${{ secrets.VUE_APP_GEMINI_API_KEY }}|g" index.html
                
              - name: Deploy 🚀
                uses: JamesIves/github-pages-deploy-action@v4
                with:
                  branch: gh-pages # A branch onde será feito o deploy
                  folder: . # A pasta raiz do seu projeto

    -->
    <script type="module">
    const { createApp, ref, computed, watch, onMounted } = Vue;
    
    // A chave da API será substituída pelo GitHub Actions durante o deploy
    // Ela é declarada aqui para estar no escopo do módulo e ser acessível dentro do createApp
    const API_KEY_PLACEHOLDER_VALUE = '{{VUE_APP_GEMINI_API_KEY}}'; 

    createApp({
        setup() {
            // --- Estado da Aplicação ---
            const apiKey = ref('');
            const isApiKeyInjected = ref(false);
            const persona = ref(localStorage.getItem('psicoAppPersona') || '');
            const pilares = ref(localStorage.getItem('psicoAppPilares') || '');
            const personaPlaceholderText = ref("Mães de primeira viagem (25-35 anos) enfrentando ansiedade, sobrecarga e os desafios do puerpério. Elas buscam validação, dicas práticas e um espaço seguro para falar sobre suas dificuldades sem julgamento.");
            const pilaresPlaceholderText = ref("1. Saúde Mental no Puerpério; 2. Autocuidado para Mães; 3. Relacionamentos após o bebê; 4. Desmistificando a Terapia Parental.");
            const tipoConteudo = ref('Carrossel');
            const topico = ref('');
            const isLoading = ref(false);
            const isGeneratingPillars = ref(false);
            const isGeneratingSuggestions = ref(false);
            const generatedContent = ref('');
            const errorMessage = ref('');
            const copyButtonText = ref('Copiar');
            const weeklySchedule = ref([]);

            // --- Funções de Inicialização e API ---
            const initializeApiKey = () => {
                const placeholderStringLiteral = '{{VUE_APP_GEMINI_API_KEY}}'; // Este é o literal que o sed procura
                const currentKeyValue = API_KEY_PLACEHOLDER_VALUE; // Este é o valor *após* a substituição do sed (ou o placeholder se não substituiu)

                // Verifica se está rodando em um domínio de GitHub Pages padrão
                const isRunningOnGitHubPages = window.location.hostname.endsWith('github.io');

                if (isRunningOnGitHubPages) {
                    // No GitHub Pages, a chave é esperada para ser injetada pelo workflow.
                    // Se o valor ainda for o placeholder ou estiver vazio, significa que não foi injetada corretamente.
                    if (currentKeyValue === placeholderStringLiteral || currentKeyValue === '') {
                        apiKey.value = ''; // Chave não injetada ou vazia
                    } else {
                        apiKey.value = currentKeyValue; // Chave injetada com sucesso
                    }
                    isApiKeyInjected.value = !!apiKey.value; // Oculta o input se a chave estiver presente
                } else {
                    // Desenvolvimento local ou outros ambientes: tenta pegar do localStorage
                    if (currentKeyValue && currentKeyValue !== placeholderStringLiteral) {
                        // Se por algum motivo o placeholder já veio com a chave (ex: teste local direto no arquivo)
                        apiKey.value = currentKeyValue;
                        isApiKeyInjected.value = true;
                    } else {
                        // Comportamento padrão de dev local: tenta do localStorage
                        apiKey.value = localStorage.getItem('geminiApiKey') || '';
                        isApiKeyInjected.value = !!apiKey.value; // Mostra o input se não estiver no localStorage ou estiver vazio
                    }
                }
                
                // Debugging Display: Atualiza a div de depuração no HTML
                const displayValue = document.getElementById('apiKeyDebugValue');
                if (displayValue) { // Garante que o elemento existe antes de tentar manipulá-lo
                    if (apiKey.value && apiKey.value !== placeholderStringLiteral) {
                        displayValue.textContent = apiKey.value.substring(0, 5) + '...'; // Mostra apenas o início da chave para segurança
                    } else if (isApiKeyInjected.value) {
                        displayValue.textContent = 'Chave injetada com sucesso (valor oculto)';
                    } else {
                        displayValue.textContent = 'Não injetada ou vazia (verificar input manual)';
                    }
                }
            };
            
            // --- Funções para Interação com a API (Stubs) ---
            // Você precisará implementar a lógica real de chamada à API aqui
            const generatePillars = async () => {
                errorMessage.value = '';
                if (!apiKey.value || !persona.value) {
                    errorMessage.value = 'Preencha a Chave da API e a Persona para gerar os pilares.';
                    return;
                }
                isGeneratingPillars.value = true;
                try {
                    // Exemplo de como a chamada à API seria
                    // const response = await fetch('SUA_URL_API_GEMINI', {
                    //     method: 'POST',
                    //     headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey.value}` },
                    //     body: JSON.stringify({ prompt: `Gere pilares de conteúdo para a persona: ${persona.value}` })
                    // });
                    // const data = await response.json();
                    // pilares.value = data.generatedPillars; // Supondo que a API retorne algo assim
                    
                    // Simulação para teste:
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    pilares.value = "1. Bem-estar Emocional Materno; 2. Desafios da Paternidade Moderna; 3. Equilíbrio Vida-Pós-Parto; 4. Saúde Mental Familiar.";
                } catch (error) {
                    console.error('Erro ao gerar pilares:', error);
                    errorMessage.value = 'Falha ao gerar pilares. Verifique sua chave da API ou tente novamente.';
                } finally {
                    isGeneratingPillars.value = false;
                }
            };

            const generateWeeklySuggestions = async () => {
                errorMessage.value = '';
                 if (!apiKey.value) {
                    errorMessage.value = 'Preencha a Chave da API para gerar sugestões semanais.';
                    return;
                }
                isGeneratingSuggestions.value = true;
                try {
                    const daysOfWeek = ['Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado', 'Domingo'];
                    const formats = ['Reel', 'Carrossel', 'Legenda Longa', 'Story Interativo'];
                    const suggestions = [];

                    for (let i = 0; i < 7; i++) {
                        const date = new Date();
                        date.setDate(date.getDate() + i); // Adiciona 'i' dias à data atual
                        const dayName = new Intl.DateTimeFormat('pt-BR', { weekday: 'long' }).format(date);
                        const formattedDate = new Intl.DateTimeFormat('pt-BR', { day: '2-digit', month: '2-digit' }).format(date);
                        
                        const randomFormat = formats[Math.floor(Math.random() * formats.length)];
                        
                        // Chamada simulada à API para cada sugestão
                        // const prompt = `Gere uma ideia de conteúdo para ${dayName} no formato de ${randomFormat}, considerando os pilares: ${pilares.value}.`;
                        // const response = await fetch('SUA_URL_API_GEMINI', { ... });
                        // const data = await response.json();
                        // suggestions.push({ dayName, date: formattedDate, format: randomFormat, suggestion: data.idea, isRegenerating: false });

                        // Simulação para teste:
                        await new Promise(resolve => setTimeout(resolve, 300)); // Pequeno delay para simular a API
                        suggestions.push({ 
                            dayName: dayName.charAt(0).toUpperCase() + dayName.slice(1), 
                            date: formattedDate, 
                            format: randomFormat, 
                            suggestion: `Sugestão de ${randomFormat} para ${dayName.charAt(0).toUpperCase() + dayName.slice(1)} sobre ${pilares.value.split(';')[0] || 'tema genérico'}.`, 
                            isRegenerating: false 
                        });
                    }
                    weeklySchedule.value = suggestions;

                } catch (error) {
                    console.error('Erro ao gerar sugestões semanais:', error);
                    errorMessage.value = 'Falha ao gerar sugestões semanais. Verifique sua chave da API ou tente novamente.';
                } finally {
                    isGeneratingSuggestions.value = false;
                }
            };

            const regenerateSuggestion = async (day, index) => {
                errorMessage.value = '';
                if (!apiKey.value) {
                    errorMessage.value = 'Preencha a Chave da API para regenerar sugestões.';
                    return;
                }
                day.isRegenerating = true;
                try {
                    // Lógica para regenerar uma sugestão específica
                    // const prompt = `Regenere uma ideia de conteúdo para ${day.dayName} no formato de ${day.format}, considerando os pilares: ${pilares.value}.`;
                    // const response = await fetch('SUA_URL_API_GEMINI', { ... });
                    // const data = await response.json();
                    // weeklySchedule.value[index].suggestion = data.newIdea;

                    // Simulação para teste:
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    weeklySchedule.value[index].suggestion = `(REGENERADA) Nova sugestão para ${day.dayName} em ${day.format}: ${pilares.value.split(';')[1] || 'tema alternativo'}.`;
                } catch (error) {
                    console.error('Erro ao regenerar sugestão:', error);
                    errorMessage.value = 'Falha ao regenerar sugestão. Tente novamente.';
                } finally {
                    day.isRegenerating = false;
                }
            };

            const selectedDayTopic = ref('');
            const selectDay = (day) => {
                selectedDayTopic.value = day.suggestion; // Usa a sugestão do dia como tópico
                topico.value = day.suggestion.split(':')[1] ? day.suggestion.split(':')[1].trim() : day.suggestion.trim(); // Tenta pegar o tópico após ':'
                // Role para a seção de geração de conteúdo
                document.getElementById('generation-module').scrollIntoView({ behavior: 'smooth' });
            };

            const generateContent = async () => {
                errorMessage.value = '';
                if (!apiKey.value || !pilares.value) {
                    errorMessage.value = 'Preencha a Chave da API e os Pilares de Conteúdo.';
                    return;
                }
                isLoading.value = true;
                generatedContent.value = ''; // Limpa o conteúdo anterior
                try {
                    let prompt = `Como psicólogo(a), especialista na persona "${persona.value || 'qualquer público'}" e com base nos pilares "${pilares.value}", gere um conteúdo completo no formato de "${tipoConteudo.value}".`;
                    if (topico.value) {
                        prompt += ` O tópico específico é: "${topico.value}".`;
                    }
                    prompt += ` O conteúdo deve ser rico, útil e profissional. Inclua hashtags relevantes no final. Use Markdown para formatação (títulos com ### ou ####, listas, negrito).`;

                    // Aqui você integraria a chamada real à API do Google Gemini
                    // Exemplo (requer SDK ou fetch direto com a estrutura da API Gemini):
                    // const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey.value}`;
                    // const response = await fetch(API_URL, {
                    //     method: 'POST',
                    //     headers: {
                    //         'Content-Type': 'application/json',
                    //     },
                    //     body: JSON.stringify({
                    //         contents: [{
                    //             parts: [{
                    //                 text: prompt
                    //             }]
                    //         }]
                    //     }),
                    // });

                    // if (!response.ok) {
                    //     const errorData = await response.json();
                    //     throw new Error(`Erro da API: ${response.status} - ${errorData.error.message || 'Erro desconhecido'}`);
                    // }

                    // const data = await response.json();
                    // const textResult = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Nenhum conteúdo gerado.';
                    // generatedContent.value = textResult;


                    // Simulação de resposta da API para desenvolvimento/teste:
                    await new Promise(resolve => setTimeout(resolve, 3000)); // Simula o tempo de resposta da API
                    let simulatedText = `### Dicas para Lidar com a Culpa Materna

A culpa materna é um sentimento comum e complexo, que muitas mães experimentam em diferentes fases da maternidade.

#### O que é a Culpa Materna?
É a sensação de não ser boa o suficiente, de estar falhando em algum aspecto da criação dos filhos ou em conciliar a vida pessoal e profissional.

* **Identifique os gatilhos:** Reflita sobre o que desencadeia sua culpa.
* **Seja gentil consigo mesma:** Lembre-se que a perfeição não existe.
* **Busque apoio:** Conversar com outras mães ou um profissional pode ajudar.

**Exemplo de Reel:**
"Eu não sou perfeita, e tudo bem!" (Mãe sorrindo, jogando o cabelo)
* Texto na tela: "Sentindo culpa materna?" (Mãe com expressão de preocupação)
* Texto na tela: "Você não está sozinha!" (Mãe abraçando o filho)
* Texto na tela: "Busque apoio e seja gentil com você. Link na bio para mais dicas!" (Mãe confiante)

#### Hashtags:
#CulpaMaterna #MaternidadeReal #SaudeMentalMaterna #Autocuidado #Psicologia #ApoioMaterno`;
                    generatedContent.value = simulatedText;
                    
                    copyButtonText.value = 'Copiar'; // Resetar texto do botão
                } catch (error) {
                    console.error('Erro ao gerar conteúdo:', error);
                    errorMessage.value = error.message || 'Falha ao gerar conteúdo. Verifique sua chave da API ou tente novamente.';
                } finally {
                    isLoading.value = false;
                }
            };

            const copyToClipboard = () => {
                navigator.clipboard.writeText(generatedContent.value).then(() => {
                    copyButtonText.value = 'Copiado!';
                }).catch(err => {
                    console.error('Falha ao copiar:', err);
                    copyButtonText.value = 'Erro ao Copiar';
                });
            };

            // Processa o conteúdo gerado para renderizar Markdown
            const renderedHtml = computed(() => {
                // Implementação simples de Markdown para HTML
                let html = generatedContent.value;
                html = html.replace(/### (.*)/g, '<h3>$1</h3>');
                html = html.replace(/#### (.*)/g, '<h4>$1</h4>');
                html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                html = html.replace(/\* (.*)/g, '<li>$1</li>');
                // Adiciona uma classe para hashtags para estilização
                html = html.replace(/#(?![\s<])([\w-]+)/g, '<span class="hashtags">#$1</span>');
                return html;
            });

            // --- Life Cycle Hooks ---
            onMounted(() => {
                initializeApiKey(); // Inicializa a chave da API quando o componente é montado
                // Adiciona um listener para salvar a API Key no localStorage ao ser digitada
                watch(apiKey, (newValue) => {
                    localStorage.setItem('geminiApiKey', newValue);
                    // Atualiza o display de debug em tempo real, se a chave for digitada manualmente
                    const displayValue = document.getElementById('apiKeyDebugValue');
                    if (displayValue && !isApiKeyInjected.value) { // Só atualiza se não for injetada (manual)
                         displayValue.textContent = newValue ? newValue.substring(0, 5) + '...' : 'Vazia';
                    }
                });
                watch(persona, (newValue) => {
                    localStorage.setItem('psicoAppPersona', newValue);
                });
                watch(pilares, (newValue) => {
                    localStorage.setItem('psicoAppPilares', newValue);
                });
            });

            // --- Retornar estado e funções para o template ---
            return {
                apiKey,
                isApiKeyInjected,
                persona,
                pilares,
                tipoConteudo,
                topico,
                isLoading,
                isGeneratingPillars,
                isGeneratingSuggestions,
                generatedContent,
                errorMessage,
                copyButtonText,
                weeklySchedule,
                personaPlaceholderText,
                pilaresPlaceholderText,
                generatePillars,
                generateWeeklySuggestions,
                regenerateSuggestion,
                selectDay,
                generateContent,
                copyToClipboard,
                renderedHtml
            };
        }
    }).mount('#app');
</script>
</body>
</html>
